---

copyright:
  years: 2015,2016

---

{:new_window: target="blank"}
{:shortdesc: .shortdesc}
{:screen:.screen}
{:codeblock:.codeblock}

# デバイスの接続および表示
{: #iotrtinsights_task}
*最終更新日: 2016 年 2 月 11 日*

{{site.data.keyword.iotrtinsights_short}} は、デバイスへのアクセスとデータの取得のために {{site.data.keyword.iot_short}} を使用します。{{site.data.keyword.iot_short}} に接続したデバイスは、{{site.data.keyword.iotrtinsights_short}} に自動的に接続されます。
{: shortdesc}

新しいタイプのデバイスを接続する場合は、メッセージ・スキーマを構成して、デバイス・データ・ポイントのマップ、単位の設定、およびデバイス・タイプの名前の指定を行う必要もあります。デバイスが既に構成されているデバイス・タイプのものである場合、そのデータは、ダッシュボードに自動的に表示されます。

## 新規デバイスの追加
{: #iotrtinsights_subtask}

新規デバイスを追加するには、以下のようにします。  
新規デバイスの追加は、2 つのステップから成るプロセスです。まず、デバイスを {{site.data.keyword.iot_short}} に追加してから、次に、{{site.data.keyword.iotrtinsights_short}} がデバイス・データをどのように取り込んで表示するのかを構成します。
1. デバイスを {{site.data.keyword.iot_short}} に追加します。
> **ヒント:** モノのインターネット電話アプリケーションをデプロイした場合、iotphone デバイスは *iot-phone-iotf-service* {{site.data.keyword.iot_short}} に既に追加されているので、このステップをスキップできます。  

  新規デバイスを {{site.data.keyword.iot_short}} に追加する場合は、[{{site.data.keyword.iot_full}} 資料](https://www.ng.bluemix.net/docs/services/IoT/index.html)および [{{site.data.keyword.iot_short}} デバイス接続用レシピ](https://developer.ibm.com/recipes/?post_type=tutorials&s=IoTF)を参照してください。
2. {{site.data.keyword.iotrtinsights_short}} でデバイスを構成します。  
  1. 管理者ユーザーとして {{site.data.keyword.iotrtinsights_short}} コンソールにログインします。
  9. **「デバイス」>「デバイスの参照 (Browse devices)」**に移動し、新たに追加したデバイスがリストされていることを確認します。
  > **ヒント:** デバイス・リストは、1 分ごとにデータ・ソースを基に最新表示されます。**「最新表示」**をクリックすると、即時にデバイス・リストが更新されます。
  3. **「デバイス」>「スキーマの管理 (Manage Schemas)」**に移動し、**「新規メッセージ・スキーマの追加 (Add new message schema)」**をクリックします。  
  4. メッセージ・スキーマの名前 (例えば、`「新規メッセージ・スキーマ」`) を入力します。
  5. **「新規データ・ソースのリンク (Link new data source)」**をクリックし、{{site.data.keyword.iot_short}} インスタンスとデバイスに対応するデータ・ソースとデバイス・タイプを選択します。オプションとして、イベント名を入力するか (そのイベントのデータのみを収集する場合)、または `+` ワイルドカードをそのままにします (すべてのイベントを収集する場合)。デバイスのイベント・タイプを識別する方法について詳しくは、[ここ](#identify-datapoints "データ・ポイントの識別")を参照してください。  
  >**重要:** 各メッセージ・スキーマでは、データ・ソース、デバイス・タイプ、およびイベント名の組み合わせが固有でなければなりません。データ・ソースとデバイス・タイプの特定の組み合わせに対して複数のスキーマを作成する場合は、デフォルトの `+` ワイルドカードを使用する代わりに、メッセージ・スキーマごとに固有のイベント名を指定します。   
  6. デバイス・ダッシュボードに含める 1 つ以上のデータ・ポイントを追加します。
    接続されているデバイスからのデータ・ポイントを選択するか、データ・ポイントを手動で追加することができます。使用可能なデータ・ポイントは、デバイスによって送信されたメッセージのペイロードに定義されています。{{site.data.keyword.iot_short}} ペイロード・フォーマットについては、{{site.data.keyword.iot_short}} 資料のトピック『[メッセージ・ペイロード (Message Payload)](https://docs.internetofthings.ibmcloud.com/messaging/payload.html "メッセージ・ペイロード (Message Payload)")』を参照してください。   
    > **ヒント:** 整数型または浮動小数点型の既存のデータ・ポイントを変更するか組み合わせた仮想データ・ポイントを手動で作成できます。例えば、デバイス・データ・ポイント temp が華氏の温度値を返すが、華氏ではなく摂氏を使用する場合は、関数 *temp_c=(temp-32)/1.8* を使用して仮想データ・ポイント *temp_c* を作成できます。その後、ルール条件で、リアルタイム・データ・ポイント *temp* の代わりに仮想データ・ポイント *temp_c* を使用できます。ダッシュボードでは、仮想データ・ポイントは破線のアンダーラインで示されます。    

  <dl>
  <dt>接続されているデバイスから選択 (Select from connected device)</dt>
  <dd>
  <ol>
    <li>**「接続されているデバイスから選択 (Select from connected device)」**をクリックします。</li>  
    <li>「データ・ポイントの追加 (Add data points)」ダイアログで、追加するデータ・ポイントを 1 つ以上選択してから、**「OK」**をクリックします。</li>   
    <li>選択したデータ・ポイントが追加され、その説明がデータ・ポイントの名前に設定されます。リスト内のデータ・ポイントをクリックして編集し、センサー・タイプ、データ型、小数点以下の桁数などの追加属性を追加します。</li>
  </ol>
  </dd>
  <dt>手動での追加 (Add manually)</dt>
  <p><b>ヒント:</b> [ネストされたデータ・ポイント構造](schemas.html)を作成する場合は、まず、データ型が「親 (Parent)」のデータ・ポイントを追加します。データ・ポイント表で、![「子の追加」アイコン](images/add_child.png "「子の追加」アイコン") をクリックして、1 つ以上の子データ・ポイントを追加します。</p>
  <dd>
  <ol>
    <li>**「手動での追加 (Add manually)」**をクリックします。</li>
    <li>**「リアルタイム・データ・ポイント (Real-time data point)」**または**「仮想データ・ポイント (Virtual data point)」**を選択します。</br></li>
    <li>以下のデータ・ポイント情報を定義します。
    <ul>  
     <li> データ・ポイント (Data point) - [{{site.data.keyword.iot_short}} ダッシュボードで見つけた](#identify-datapoints "データ・ポイントの識別")データ・ポイント ID。例:  
   `id`、`ts`、`lat`  </li>
     <li>説明 - データ・ポイントの簡略説明。この説明は、ダッシュボードでデータ・ポイントを表示する際に使用されます。</li>
     <li>仮想データ・ポイント関数 (Virtual data point function) - 1 つ以上のコンポーネントを追加して有効な関数を定義します。データ・ポイント、数値、および数学演算子 +、-、\*、/、(、) を使用して、関数を構築できます。</li>
     <li>データ型 (Data type) - データ・ポイントのデータの型:  
   `「ストリング (String)」`、`「整数 (Integer)」`、`「浮動小数点 (Float)」`、または`「親 (Parent)」`。</li>
     <li>センサー・タイプ (Sensor type) - オプションとして、ダッシュボードでデータ・ポイントを解釈する方法を選択します。型とセンサー・タイプの組み合わせに応じて、ダッシュボード・ウィジェットの追加の可視化オプションが使用可能な場合があります。センサー・タイプと可視化オプションについて詳しくは、『[ダッシュボード・ウィジェット](dashboards.html#dashboard-widget "ダッシュボード・ウィジェット")』を参照してください。</li>
     <li>「データ・ポイント」アイコン (Data point icon) - オプションとして、ダッシュボード・ウィジェットでデータ・ポイントを表すアイコンを選択します。</li>
     <li>最小値 (Min value)/最大値 (Max value) - オプション。整数および浮動小数点の場合のみ。最大値と最小値を入力した場合、ダッシュボードでゲージとしてデバイス・データを表示できます。</li>
     <li>データ単位 (Data unit) - オプション。データ・ポイントのデータの単位。例:  
     `C`、`Mph`  </li>
     <li> 小数点以下の桁数 (Decimal places) - オプション。浮動小数点の場合のみ。デバイス・データに含める小数点以下の桁数。</li>
    </ul>
    </li>
  </ol>
  </dd>
  </dl>
   8. **「OK」**をクリックして、メッセージ・スキーマを作成します。
   9. **「デバイス」>「デバイスの参照 (Browse devices)」**に移動し、新たに追加したデバイスをクリックして、リアルタイム・デバイス・データが表示されていること、およびデータ・ポイントが正しくマップされていることを確認します。

## {{site.data.keyword.iot_short}} ダッシュボードでのデータ・ポイントおよびイベントの識別
{: #identify-datapoints}
   デバイスのデータ・ポイントおよびイベント・タイプは、{{site.data.keyword.iot_short}} ダッシュボードで確認できます。
   >**ヒント:** モノのインターネット電話アプリケーションを IoT デバイスとして使用している場合、sensorData イベントおよび以下のデータ・ポイントを使用して、メッセージ・スキーマを構成できます。
   >- d.id - デバイス ID
   >- d.ts - タイム・スタンプ
   >- d.lat - 緯度
   >- d.lng - 経度
   >- d.ax - X 加速度
   >- d.ay - Y 加速度
   >- d.az - Z 加速度
   >- d.oa - アルファ移動
   >- d.ob - ベータ移動
   >- d.og - ガンマ移動
   >ここで、d.*データ・ポイント* は、メッセージ・ペイロードでデータ・ポイントが親データ型の d データ・ポイントの下にネストされていることを示します。

   1. Bluemix ダッシュボードで、「モノのインターネット」タイルをクリックします。  
   >**注:** モノのインターネット電話アプリケーションを使用している場合、*iot-phone-iotf-service* タイルをクリックします。  
   2. **「ダッシュボードの起動 (Launch dashboard)」**をクリックして、{{site.data.keyword.iot_short}} ダッシュボードを開きます。
   3. **「デバイス」**ページに移動します。
   4. デバイスをクリックして、デバイス詳細ページを開きます。
     **「センサー情報 (Sensor Information)」**セクションまでスクロールダウンし、デバイスの使用可能なイベントおよびデータ・ポイントのリストを表示します。この情報は、{{site.data.keyword.iotrtinsights_short}} でデバイスを構成する際に必要になります。
