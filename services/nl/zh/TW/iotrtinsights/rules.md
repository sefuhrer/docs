---

copyright:
  years: 2015,2016

---

{:shortdesc: .shortdesc}

# 建立規則及回應警示{: #rules}

使用分析規則，以設定您裝置的警示及通知。例如，您可以建立規則，以在裝置的溫度感應器記錄異常高溫時，將警示新增至裝置儀表板，並將電子郵件傳送給管理者。
{: shortdesc}

您可以使用包括下列條件的規則：比較資料點或環境定義參數（例如資產對映）與靜態值、其他資料點或環境定義參數。

>**附註：**當您使用免費方案的 {{site.data.keyword.iotrtinsights_short}} 實例時，會在一個小時之後自動取消啟動所有規則。您可以手動重新啟動這些規則。若要涵蓋連續規則，您可以升級至付費方案。

若要建立裝置的規則，請執行下列動作：
1. 在 {{site.data.keyword.iotrtinsights_short}} 主控台中，移至**分析 > 規則**。
2. 按一下**新增規則**、提供規則的名稱、提供說明，以及選取規則的訊息綱目，然後按**下一步**。  
3. 按一下**確定**，以建立新規則。
3. **選用項目：**選取規則的警示優先順序。
優先順序用來分類「警示」畫面中所顯示的警示。預設優先順序為「低」。
3. 若要設定規則邏輯，請新增一個以上的 IF 條件，用來作為規則的觸發程式。
您可以在平行列中新增條件以將它們套用為 OR 條件，也可以在循序直欄中新增條件以將它們套用為 AND 條件。
**提示：**若要瞭解您裝置所傳回的一般值，請移至**裝置 > 瀏覽裝置**，然後按一下您的裝置來查看所顯示的即時資料。
**重要事項：**若要觸發一個比較兩個資料點的條件，或是要觸發兩個以上循序結合的資料點條件，則必須將觸發資料包括在相同的訊息中。如果在多個訊息中收到資料，條件或循序條件並不會進行觸發。  
> **範例：**   
如果參數值大於指定的值，則簡單規則可能會觸發警示。  
例如：條件 = `ax>5`  
如果對映至特定資產之裝置的參數值超出特定值，則較複雜的規則可能會觸發警示。  
例如：條件 = `ax>5 AND asset.assetnum==5001`   
如需詳細步驟，請參閱[範例：使用訊息綱目及環境定義參數條件來建立複雜規則](#complex "範例：使用訊息綱目及環境定義參數條件來建立複雜規則")。  
4. 配置規則的條件式觸發程式需求。
若要控制某個時段針對規則所觸發的警示數目，您可以配置規則的條件式觸發程式需求。
**重要事項：**條件式觸發會作用於規則中的所有條件。例如，如果規則已設定 5 個不同的平行 (OR) 條件，則每一個成立的條件都會計入條件式觸發程式計數。
若要設定規則的條件式觸發，請執行下列動作：
 1. 在規則編輯器中，按一下 **Trigger each time conditions are met** 鏈結，以開啟條件對話框。
 2. 選取並配置要與規則搭配使用的條件式觸發程式。
 <ul>
 <li>Trigger every time conditions are met</li>
 <li>Trigger if conditions are met N times in M *Unit of time*</li>
 </ul>  
如需條件式觸發程式的進一步詳細說明，請參閱[條件式觸發](#conditional "條件式觸發概觀")。
5. 建立或選取在符合規則條件時發生的一個以上動作。
如需動作的相關資訊，請參閱[建立動作](actions.html#shared "建立動作")。   
 > 例如：動作可以是傳送電子郵件。如需不同動作類型的相關資訊，請參閱[動作類型](actions.html "動作類型")。
6. 當規則符合您的要求時，請按一下**儲存**。
7. 在「規則」頁面上，按一下 ![「配置」圖示](images/gear.png "「配置」圖示")，然後選取**啟動**來啟動規則。

您的規則在作用中。如果符合規則的條件，則會將警示新增至**儀表板 > 概觀**儀表板，並執行任何規則動作。

## 條件式觸發{: #conditional}

若要控制某個時段針對規則所觸發的警示數目，您可以配置規則的條件式觸發程式需求。

根據訊息頻率及規則條件，在符合觸發條件之後，規則可能會觸發多次。例如，如果條件為 `temp >= 90`，而且溫度增加並穩定於 91，則每一則送入訊息現在都會觸發規則。例如，根據裝置訊息的頻率，以及規則設定要執行的動作，這可能會快速填滿您的電子郵件收件匣，或是在 Twitter 資訊來源中湧入除了第一則訊息外沒有提供任何其他值的訊息。

**重要事項：**條件式觸發作用於規則中的所有條件。例如，如果規則已設定 5 個不同的平行 (OR) 條件，則每一個成立的條件都會計入條件式觸發程式計數。

條件 | 說明
------------- | -------------
Trigger every time conditions are met | 每次符合規則條件時，都會觸發規則。
Trigger if conditions are met N times in M *days/hours/minutes/custom* | 規則會在選取的時間間隔內符合條件 N 次時觸發，然後在經過配置的時段之前都不會再次觸發。</br>範例：條件式觸發程式需求 =`Trigger only once if conditions are met 4 times in 30 minutes`。裝置每隔五分鐘會傳送一則新訊息。在中午，溫度開始超過 90 度，而這符合了該條件。此時會啟動條件式觸發程式計數器，但尚未觸發規則。過了 15 分鐘，而且接收到另外三則訊息指出 `temp > 90` 之後，即會觸發規則。接下來的 15 分鐘內，不論溫度多少，都不會再次觸發規則。

## 範例：使用訊息綱目及環境定義參數條件來建立複雜規則{: #complex}
若要建立更複雜的規則，以在 ax 參數超過對映至資產號碼 5001 的任何 IoT Phone 裝置的值 5 時於「警示儀表板」中建立警示，請執行下列步驟：
1. 移至**裝置 > 管理資產對映**，然後將至少一個 IoT Phone 裝置對映至資產號碼為 5001 的資產。
如需詳細步驟，請參閱[管理資產](assets.html "管理資產")。
2. 移至**分析**，然後按一下**新增規則**。
3. 提供規則的敘述性名稱及說明，並且藉由選取您為 IoT Phone 裝置類型所建立的訊息綱目，來指定規則適用的裝置類型。
4. 按一下**確定**，以建立新規則。
<!-- 5. Click ![Add icon.](images/rules_plus.png "Add icon") to add an initial condition. -->
6. 按一下新條件磚，然後編輯起始條件。
 1. 選取**資料點**作為要比較的運算元。
 2. 選取 **ax** 資料點。
 3. 選取 **>** 運算子，使得在第一個運算元的值大於第二個運算元的值時，條件成立。
 3. 選取**靜態值**作為要與之比較的運算元。
 4. 輸入值 `5`，以與 ax 資料點相互比較。
 5.  按一下**確定**，以新增條件。
5. 若要新增 AND 條件，請按一下第一個條件右側的 ![「新增」圖示](images/rules_plus.png "「新增」圖示")。
6. 按一下新條件磚，然後編輯條件。
  1. 選取**環境定義**作為要比較的運算元。
  2. 在環境定義參數功能表中，按一下**資產**環境定義綱目前面的三角形，以展開資產環境定義參數清單。
  3. 選取 **ASSETNUM** 環境定義綱目參數。
  3. 選取 **==** 運算子，則表示在第一個運算元與第二個運算元的值相等時條件成立。
  3. 選取**靜態值**作為要與之比較的運算元。
  4. 輸入 `5001` 作為要與 **ASSETNUM** 環境定義綱目參數相互比較的值。
  5.  按一下**確定**，以建立條件。
7. 使用預設的 `Trigger every time conditions are met` 條件式觸發程式。
7. 建立或選取一個以上的動作。
7. 儲存新規則。
7. 在「規則」頁面的新增規則磚中，按一下 ![「配置」圖示](images/gear.png "「配置」圖示")，然後選取**啟動**來啟動規則。

## 範例：建立資產型規則{: #asset_rules}

將裝置順利對映至資產之後，您可以建立使用資產詳細資料的規則。將裝置對映至資產，以及建立同時包含資料點和資產資訊的規則，是一項功能強大的工具。

在下列範例中，我們使用資產來追蹤公司的行動電話。我們建立了兩個資產，並將它們對映至行動電話。資產 5001 對映至 PURCHASEPRICE < 100 的電話，而資產 5002 則對映至 PURCHASEPRICE >=100 的電話。每個範例的裝置資料觸發條件都是 `d.ax>5`，在這個簡化的範例中，此條件對應至電話的突然加速（例如電話掉落的情況）。

您現在可以設定兩個簡單的規則，以在對映至資產 5001 的電話掉落時通知我們。設定規則來追蹤未對映至 5001 的電話何時掉落，也同樣相當簡單。這可以是 5002 中的任何電話，或根本未對映至資產的任何電話。

範例 | 規則
------------- | -------------
只有在裝置屬於資產 5001 時才觸發規則 | IF `d.ax>5` AND  `asset.assetnum==5001` THEN ...
只有在裝置「不」屬於資產 5001 時才觸發規則 | IF `d.ax>5` AND  `asset.assetnum!=5001` THEN ...

您也可以設定針對具有特定 PURCHASEPRICE 的電話而觸發的規則。  

範例 | 規則
------------- | -------------
只有在電話成本低於 100 時才觸發規則 | IF `d.ax>5` AND  `asset.purchaseprice<100` THEN ...
只有在電話成本高於 100 時才觸發規則 | IF `d.ax>5` AND  `asset.purchaseprice>=100` THEN ...

最後，您可以合併這些規則來進行更複雜的行為。

範例 | 規則
------------- | -------------
只有在電話屬於資產 5001（成本低於 100）但成本高於 75 時才觸發規則 | IF `d.ax>5` AND `asset.assetnum==5001` AND  `asset.purchaseprice>75` THEN ...
只有在電話屬於資產 5002（成本高於 100）但成本低於 200 時才觸發規則 | IF `d.ax>5`  AND `asset.assetnum==5002` AND  `asset.purchaseprice<200` THEN ...
