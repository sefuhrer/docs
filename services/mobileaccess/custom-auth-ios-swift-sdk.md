---

copyright:
  years: 2016

---

# Configuring {{site.data.keyword.amashort}} client SDK for iOS (Swift SDK)
{: #custom-ios}

Configure your iOS application that is using custom authentication to use the {{site.data.keyword.amashort}} client SDK and connect your application to {{site.data.keyword.Bluemix}}.

## Before you begin
{: #before-you-begin}

You must have a resource that is protected by an instance of the {{site.data.keyword.amashort}} service that is configured to use a custom identity provider.  Your mobile app also must be instrumented with the {{site.data.keyword.amashort}} client SDK.  For more information, see the following information:
 * [Getting started with {{site.data.keyword.amashort}}](https://console.{DomainName}/docs/services/mobileaccess/getting-started.html)
 * [Setting up the iOS Swift SDK](https://console.{DomainName}/docs/services/mobileaccess/getting-started-ios-swift-sdk.html)
 * [Using a custom identity provider](https://console.{DomainName}/docs/services/mobileaccess/custom-auth.html)
 * [Creating a custom identity provider](https://console.{DomainName}/docs/services/mobileaccess/custom-auth-identity-provider.html)
 * [Configuring {{site.data.keyword.amashort}} for custom authentication](https://console.{DomainName}/docs/services/mobileaccess/custom-auth-config-mca.html)


## Configuring {{site.data.keyword.amashort}} for custom authentication
 {: #custom-auth-ios-configmca}

 1. Open your app in the {{site.data.keyword.Bluemix_notm}} dashboard.

 1. Click **Mobile Options** and take note of **Route** (*applicationRoute*) and **App GUID** (*applicationGUID*). You need these values when you initialize the SDK.

 1. Click the {{site.data.keyword.amashort}} tile. The {{site.data.keyword.amashort}} dashboard loads.

 1. Click the **Custom** tile.

 1. In **Realm name**, specify your custom authentication realm.

 1. In **URL**, specify your applicationRoute.

 1. Click **Save**.

## Configuring the {{site.data.keyword.amashort}} client SDK for iOS
 {: #custom-auth-ios-sdk}

### Installing CocoaPods
 {: #custom-auth-cocoapods}

 The {{site.data.keyword.amashort}} client SDK is distributed with CocoaPods, a dependency manager for iOS projects. CocoaPods automatically downloads artifacts from repositories and makes them available to your iOS application.

 1. Open Terminal and run `pod --version` command. If you already have CocoaPods installed, the version number is displayed. You can skip to the next section of this tutorial.

 1. Install CocoaPods by running `sudo gem install cocoapods`. Refer to [CocoaPods website](https://cocoapods.org/) in case additional guidance is required.

 1. Close XCode.

 1. Open Terminal and `cd` into your project directory.

 1.  Run `pod init`.

### Installing the client SDK with CocoaPods
{: #custom-ios-sdk-cocoapods}

Use the CocoaPods dependency manager to install the {{site.data.keyword.amashort}} client SDK.

1. Open Terminal and navigate to the root directory of your iOS project.

1. Edit the `Podfile` and add the following lines.

 ```
 use_frameworks!
 pod 'BMSSecurity'
 ```
 **Tip:** You can add `use_frameworks!` to your Xcode target instead of having it in the Podfile.

1. From the command line, run `pod install`.
CocoaPods installs added dependencies. The progress and which components were added are displayed.

 **Important**: You must now open your project by using a xcworkspace file that was generated by CocoaPods. Usually the name is `{your-project-name}.xcworkspace`.  

1. Run `open {your-project-name}.xcworkspace` from command line to open your iOS project workspace.

### Initializing the client SDK
{: #custom-ios-sdk-initialize}

Initialize the SDK by passing the `applicationRoute`and `applicationGUID` parameters. A common, though not mandatory, place to put the initialization code is in the `application:didFinishLaunchingWithOptions` method of your application delegate

1. Get your application parameter values. Open your app in the {{site.data.keyword.Bluemix_notm}} dashboard. Click **Mobile Options**. The `applicationRoute` and `applicationGUID` values are displayed in the **Route** and **App GUID** fields.

1. Import the required frameworks in the class where you want to use {{site.data.keyword.amashort}} client SDK.

 ```Swift
 import UIKit
 import BMSCore
 import BMSSecurity
```

1. Initialize the {{site.data.keyword.amashort}} client SDK, change the authorization manager to be MCAAuthorizationManager, and define an authentication delegate and register it. Replace the `<applicationRoute>` and `<applicationGUID>` with values for **Route** and **App GUID** that you obtained from **Mobile Options** in the {{site.data.keyword.Bluemix_notm}} dashboard.

 ```Swift
 let backendURL = "<applicationRoute>"
 let backendGUID = "<applicationGUID>"
 let customRealm = "<your protected resource's realm>"

 func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool {

 BMSClient.sharedInstance.initializeWithBluemixAppRoute(backendURL, bluemixAppGUID: backendGUID, bluemixRegion: BMSClient.<application Bluemix region>)

 BMSClient.sharedInstance.authorizationManager = MCAAuthorizationManager.sharedInstance

  //Auth delegate for handling custom challenge
 class MyAuthDelegate : AuthenticationDelegate {
      func onAuthenticationChallengeReceived(authContext: AuthenticationContext, challenge: AnyObject){
          print("onAuthenticationChallengeReceived")
              let answer = <An answer to the challenge sent by the backend (Should be of type [String:AnyObject])>
              authContext.submitAuthenticationChallengeAnswer(answer)
      }

      func onAuthenticationSuccess(info: AnyObject?) {
           print("onAuthenticationSuccess info = \(info)")
           print("onAuthenticationSuccess")
      }

      func onAuthenticationFailure(info: AnyObject?){
        print("onAuthenticationFailure info = \(info)")
        print("onAuthenticationFailure")
      }
  }

  let delegate = MyAuthDelegate()
  let mcaAuthManager = MCAAuthorizationManager.sharedInstance

 do {
      try mcaAuthManager.registerAuthenticationDelegate(delegate, realm: customRealm)
  } catch {
      print("error with register: \(error)")
  }
 return true
 }   
 ```

## Testing the authentication
{: #custom-ios-testing}

After you initialize the client SDK and register a custom authentication delegate, you can start making requests to your mobile backend.

### Before you begin
{: #custom-ios-testing-before}

 You must have an application that was created with the {{site.data.keyword.mobilefirstbp}} boilerplate and have a resource that is protected by {{site.data.keyword.amashort}} at the `/protected` endpoint.

1. Send a request to protected endpoint of your mobile backend in your browser by opening `{applicationRoute}/protected`, for example `http://my-mobile-backend.mybluemix.net/protected`.
  The `/protected` endpoint of a mobile backend that is created with the {{site.data.keyword.mobilefirstbp}} boilerplate is protected with {{site.data.keyword.amashort}}. The endpoint can  be accessed by only mobile applications that are instrumented with the {{site.data.keyword.amashort}} client SDK. As a result, an `Unauthorized` message displays in your browser.

1. Use your iOS application to make request to the same endpoint. Add the following code after you initialize `BMSClient` and register your custom authentication delegate:

 ```Swift
 let customResourceURL = "<your protected resource's path>"
 let request = Request(url: customResourceURL, method: HttpMethod.GET)
 let callBack:BmsCompletionHandler = {(response: Response?, error: NSError?) in
  if error == nil {
      print ("response:\(response?.responseText), no error")
  } else {
      print ("error: \(error)")
  }
 }

 request.sendWithCompletionHandler(callBack)
 ```

1. 	When your requests succeeds, you see the following output in the Xcode console:

 ```
 onAuthenticationSuccess info = Optional({
     attributes =     {
     };
     deviceId = don;
     displayName = "Don+Lon";
     isUserAuthenticated = 1;
     userId = don;
 })
 response:Optional("Hello Don Lon"), no error
 ```

1. You can also add logout functionality by adding the following code:

 ```
 MCAAuthorizationManager.sharedInstance.logout(callBack)
 ```  

 If you call this code after a user is logged in, the user is logged out. When the user tries to log in again, they must answer the challenge received from the server again.

 Passing `callBack` to the logout function is optional. You can also pass `nil`.
